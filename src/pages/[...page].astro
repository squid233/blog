---
import type { GetStaticPaths } from "astro";
import Pagination from "../components/control/Pagination.astro";
import PostPage from "../components/PostPage.astro";
import { PAGE_SIZE } from "../constants/constants";
import MainGridLayout from "../layouts/MainGridLayout.astro";
import { getSortedPosts } from "../utils/content-utils";
import { supabase } from "@/lib/supabase";

// export const getStaticPaths = (async ({ paginate }) => {
// 	const allBlogPosts = await getSortedPosts();
// 	return paginate(allBlogPosts, { pageSize: PAGE_SIZE });
// }) satisfies GetStaticPaths;
// // https://github.com/withastro/astro/issues/6507#issuecomment-1489916992

// const { page } = Astro.props;

// const len = page.data.length;

const { data: posts, error } = await supabase
  .from('posts')
  .select('*')
  .eq('draft', false)
  .order('published_at', { ascending: false })
  .limit(PAGE_SIZE);

if (error) {
  console.error('Error fetching posts:', error.message);
}

const len = posts ? posts.length : 0;
---

<MainGridLayout>
    {
        error
            ? <p class="text-red-500">加载文章时出错: {error?.message}</p>
            : (
            <PostPage posts={posts}></PostPage>
            // <Pagination class="mx-auto onload-animation" posts={posts} style={`animation-delay: calc(var(--content-delay) + ${(len)*50}ms)`}></Pagination>
            )
    }
    {/*
    <PostPage page={page}></PostPage>
    <Pagination class="mx-auto onload-animation" page={page} style={`animation-delay: calc(var(--content-delay) + ${(len)*50}ms)`}></Pagination>
    */}
</MainGridLayout>